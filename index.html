<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chat Privado</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#141e30,#243b55);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card{
  background:white;
  width:400px;
  padding:25px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
}

h2{
  text-align:center;
}

input{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#1e88e5;
  color:white;
  font-size:16px;
  cursor:pointer;
}

button:hover{
  background:#1565c0;
}

.chat{
  display:none;
  flex-direction:column;
  height:500px;
}

.messages{
  flex:1;
  overflow-y:auto;
  border:1px solid #ddd;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
}

.msg{
  background:#f1f1f1;
  padding:6px;
  margin:5px 0;
  border-radius:6px;
}
</style>
</head>
<body>

<div class="card" id="login">
  <h2>Login</h2>
  <input type="text" id="username" placeholder="Usuario">
  <input type="password" id="password" placeholder="Contraseña">
  <button onclick="login()">Entrar</button>
</div>

<div class="card chat" id="chat">
  <h2>Chat</h2>
  <div class="messages" id="messages"></div>
  <input type="text" id="messageInput" placeholder="Escribe mensaje">
  <button onclick="sendMessage()">Enviar</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where, addDoc, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB8MX9UKhyhatywGhPbpIldBD80wsY38BI",
  authDomain: "chat01234.firebaseapp.com",
  projectId: "chat01234",
  storageBucket: "chat01234.firebasestorage.app",
  messagingSenderId: "861947372030",
  appId: "1:861947372030:web:3f1d0c4709b3d96fe6a0af"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.login = async function(){
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;

  const q = query(
    collection(db,"users"),
    where("username","==",user),
    where("password","==",pass)
  );

  const snapshot = await getDocs(q);

  if(snapshot.empty){
    alert("Usuario o contraseña incorrectos");
  } else {
    document.getElementById("login").style.display="none";
    document.getElementById("chat").style.display="flex";
    loadMessages();
  }
}

window.sendMessage = async function(){
  const text = document.getElementById("messageInput").value;
  if(text==="") return;

  await addDoc(collection(db,"messages"),{
    text:text,
    createdAt:new Date()
  });

  document.getElementById("messageInput").value="";
}

function loadMessages(){
  const q = query(collection(db,"messages"),orderBy("createdAt"));

  onSnapshot(q,(snapshot)=>{
    const messagesDiv=document.getElementById("messages");
    messagesDiv.innerHTML="";
    snapshot.forEach(doc=>{
      const div=document.createElement("div");
      div.classList.add("msg");
      div.textContent=doc.data().text;
      messagesDiv.appendChild(div);
    });
  });
}

</script>

</body>
</html>
